---
- name: install setup tools
  apt:
    name: ['python3-setuptools']
    state: present
    update_cache: yes

- name: download
  include_role:
    name: install-1.0.5
  vars:
    opts:
      pkg_name: qingcloud-cli
      pkg_version: "{{ qingcloud_cli_version }}"
      dest_path: /tmp/qingcloud-cli-{{ qingcloud_cli_version }}
      pkg_type: tgz
      pkg_url: https://github.com/yunify/qingcloud-cli/archive/{{ qingcloud_cli_version }}.tar.gz
      extracts: yes
      creates: setup.py

- name: set up mirror
  copy:
    dest: ~/.pydistutils.cfg
    content: |
      [easy_install]
      index_url = https://pypi.doubanio.com/simple

- name: install pip
  apt:
    name: python-pip
    update_cache: yes

- name: install qingcloud-cli
  pip:
    executable: pip
    name: qingcloud-cli=={{ qingcloud_cli_version }}

- name: set up mirror
  file:
    path: ~/.pydistutils.cfg
    state: absent
